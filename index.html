<!DOCTYPE HTML>
<html>
<head>
    <meta charset='utf-8'>
    <meta name='viewport' content='width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0'>
    <style>
        input[type=file] {
            display: none;
        }

        .frostedGlass {
            border-radius: 20px;
            overflow: hidden;
            background-color: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px)
        }

        .btnLabel {
            background-color: lightgray;
            padding: 8px;
            margin: 2px;
            border-radius: 4px;
            text-align:center;
            flex-basis:auto;
            flex-grow: 1;
            flex-shrink: 1;
        }

        .btnLabel:hover {
            background-color: gray;
        }

        .controlPanel {
            max-height: 1000px;
            display: flex;
            flex-direction: column;
            position: absolute;
            align-items: center;
            right: 0px;
            top: 0px;
        }

        .panelHeader {
            color: white;
            text-align: center;
        }

        #palette {
            width: 400px;
            height: 600px;
            margin: 20px;
        }

        .saveSpace {
            width: 100%;
            height: 20px;
        }

        #closeBtn {
            background-color: lightgray;
            text-align: center;
            width: 100%;
            user-select: none;
            -moz-user-select: none;
            -webkit-user-select: none;
        }

        #closeBtn:hover {
            background-color: darkgray;
        }

        .settingForm {
            display: flex;
            flex-wrap: wrap;
            padding-top: 10px;
            padding-bottom: 10px;
            justify-content: center;
        }

        .close {
            max-height: 0px;
            overflow: hidden;
            transform-origin: top;
            -webkit-transform-origin: top;
            -moz-transform-origin: top;
            transition: max-height 0.8s ease-in-out;
            -webkit-transition: max-height 0.8s ease-in-out;
            -moz-transition: max-height 0.8s ease-in-out;
        }

        .open {
            max-height: 100vh;
            transform-origin: top;
            -webkit-transform-origin: top;
            -moz-transform-origin: top;
            transition: max-height 0.8s ease-in-out;
            -webkit-transition: max-height 0.8s ease-in-out;
            -moz-transition: max-height 0.8s ease-in-out;
        }

        .noDisplay{
            display:none
        }

    </style>
</head>
<body style="padding:0px;margin:0px;width:100vw;height:100vh">
    <div id="controlPanel" class="controlPanel frostedGlass" data-collapsed="false">

        <!--標題-->
        <div class="panelHeader saveSpace">Control Panel</div>

        <!--內容-->
        <div class="panelContent open">
            <div class="settingForm" >
                <label class="btnLabel"><input type="file" name="settingForm" accept=".raw">load .raw</label>
                <label class="btnLabel noDisplay"><input type="file" name="settingForm" accept=".tf">load .tf</label>
                <label class="btnLabel noDisplay" name="settingForm">save .tf</label>
                <label class="btnLabel noDisplay"><input type="file" name="settingForm">saveData</label>
                <label class="btnLabel" name="settingForm">sized based</label>
            </div>
            <div id="palette"></div>
        </div>

        <!--收合按鈕-->
        <div id="closeBtn" class="saveSpace">close</div>

    </div>

    <script type="module">
        
        import { ScaleField } from './jsm/scaleField.js'
        import { threejsViewer } from './jsm/threejsViewer.js'
        import { ControlView, colorSetting } from './jsm/controlView.js'

        // 檔名正規語言判定規則
        const fileRegex = /(\w+)_(\d+)x(\d+)x(\d+)_(\w+)\.*/;
        
        let field
        let controlView = null// 控制面板
        let modelView = null// webgl畫布
        let arg = new colorSetting()// 控制面板參數設置
        
        let getColormap = function () {
            let color = new Uint8ClampedArray(256 * 4)
            for (let i = 0; i < 256; i++) {
                color[4 * i] = arg.rgba[0][i] * 256
                color[4 * i + 1] = arg.rgba[1][i] * 256
                color[4 * i + 2] = arg.rgba[2][i] * 256
                color[4 * i + 3] = arg.rgba[3][i] * 256
            }

            return color
        }

        function init() {

            // 收合按鈕:點擊事件設置
            let closeBtn = document.getElementById('closeBtn')
            let controlPanel = document.getElementById('controlPanel')
            let content = controlPanel.getElementsByClassName('panelContent')[0]
            closeBtn.addEventListener('click', function (evt) {
                evt.preventDefault()

                if (controlPanel.dataset.collapsed == 'true') {
                    content.classList.remove('close')
                    content.classList.add('open')
                    controlPanel.dataset.collapsed = false
                }
                else {
                    content.classList.add('close')
                    content.classList.remove('open')
                    controlPanel.dataset.collapsed = true
                }
            })

            let elements = document.getElementsByName('settingForm')

            // RAW文件讀取
            elements[0].addEventListener('change', (evt) => {
                
            })

            // 執行Size based transfer function
            elements[4].addEventListener('click', (evt) => {

            })


        }
        
        window.onload = () => {
            modelView = new threejsViewer(document.body)
            controlView = new ControlView(document.getElementById('palette'), arg)

            // 控制面板參數調整時，可觸發事件
            controlView.addEventListener('change', () => {
                
            })
            
            init()
        }
    </script>

</body>
</html>